---
import BaseLayout from "../../layouts/PageLayout.astro";
import { Icon } from "astro-icon";
export async function getStaticPaths() {
  const allPosts = await Astro.glob("../blog/*.md");

  const uniqueTags = [
    ...new Set(allPosts.map(post => post.frontmatter.tags).flat()),
  ];

  return uniqueTags.map(tag => {
    const filteredPosts = allPosts.filter(post =>
      post.frontmatter.tags.includes(tag)
    );
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout pageTitle={tag}>
  <div class="mb-20 border-b-2 pb-6 text-2xl">#{tag}</div>
  <ul>
    {
      posts.map(post => (
        <a href={`/blog/${post.frontmatter.link}`}>
          <div class="grid grid-cols-2 mb-20 h-full overflow-hidden transition-all duration-100 ease-in-out bg-white rounded-xl hover:border-r-2 hover:bg-slate-50">
            <img class="rounded-md w-11/12" src={post.frontmatter.image} />
            <div>
              <div class="text-2xl">{post.frontmatter.title}</div>
              <div class="pb-4">
                {post.frontmatter.date} | {post.frontmatter.tags}
              </div>
              <div>{post.frontmatter.description}</div>
            </div>
          </div>
        </a>
      ))
    }
  </ul>
</BaseLayout>
